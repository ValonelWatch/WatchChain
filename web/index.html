<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>WatchChain ‚Äî Echo</title>
  <link rel="icon" href="icon.png" />
  <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º TonConnectUI –∫–∞–∫ UMD-–±–∞–Ω–¥–ª -->
  <script src="https://unpkg.com/@tonconnect/ui/dist/tonconnect-ui.min.js"></script>
  <style>
    body { background: #111; color: #eee; font-family: Arial, sans-serif; text-align: center; padding: 2rem; }
    #ton-connect-button { margin: 1rem auto; }
    #app { display: none; margin-top: 1rem; }
    textarea { width: 90%; height: 6rem; padding: 0.5rem; background: #222; color: #eee; border: none; border-radius: 4px; }
    button { padding: 0.5rem 1rem; margin-top: 0.5rem; background: #00ffc8; color: #000; border: none; border-radius: 4px; cursor: pointer; }
    #status { margin-top: 0.75rem; min-height: 1.2rem; }
  </style>
</head>
<body>
  <h1>WatchChain ‚Äî Echo</h1>

  <!-- –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ -->
  <div id="ton-connect-button"></div>

  <div id="app">
    <textarea id="message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç‚Ä¶"></textarea><br />
    <button id="send">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å 0.001 TON</button>
    <div id="status"></div>
  </div>

  <script>
    // –ê–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–Ω–æ–≥–æ EchoContract
    const CONTRACT_ADDRESS = 'EQBvL1b1vvi-yXP_leOiX3tsOBawWItXOf9FmB0xCl6chsx5';

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º TonConnectUI
    const tonConnectUI = new TonConnectUI({
      manifestUrl: window.location.origin + '/tonconnect-manifest.json'
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∫–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω
    tonConnectUI.onStatusChange(wallet => {
      document.getElementById('app').style.display = wallet ? 'block' : 'none';
    });

    document.getElementById('send').onclick = async () => {
      const statusEl = document.getElementById('status');
      statusEl.textContent = '';

      try {
        // –ï—Å–ª–∏ –µ—â—ë –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ—Å—Ç
        if (!tonConnectUI.wallet) {
          await tonConnectUI.connect();
        }

        const text = document.getElementById('message').value.trim();
        if (!text) {
          statusEl.textContent = '‚ùó –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è';
          return;
        }

        // –ö–æ–¥–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤ base64
        const bytes = new TextEncoder().encode(text);
        const payloadBase64 = btoa(String.fromCharCode(...bytes));

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–∫–æ—à–µ–ª–µ–∫ —Å–∞–º —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é)
        await tonConnectUI.sendTransaction({
          validUntil: Math.floor(Date.now() / 1000) + 600,
          messages: [{
            address: CONTRACT_ADDRESS,
            amount: '1000000',       // 0.001 TON
            payloadBase64
          }]
        });

        statusEl.textContent = '‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
      } catch (e) {
        console.error(e);
        statusEl.textContent = '‚ùå ' + (e.message || e);
      }
    };
  </script>
</body>
</html>
